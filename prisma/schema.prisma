generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  price       Float
  image       String?
  category    String?
  stock       Int            @default(0)
  seasonalTag String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  cartItems   CartItem[]
  orderItems  OrderItem[]
  images      ProductImage[]
  reviews     Review[]

  @@index([seasonalTag])
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  productId Int
  url       String
  isCover   Boolean @default(false)
  position  Int     @default(0)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model User {
  id            String     @id @default(cuid())
  name          String?
  email         String     @unique
  emailVerified DateTime?
  password      String
  image         String?
  role          String     @default("USER")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  cartItems     CartItem[]
  orders        Order[]
  reviews       Review[]
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

model Order {
  id              String      @id @default(cuid())
  userId          String
  total           Float
  status          String      @default("PENDING")
  paymentStatus   String      @default("PENDING")
  shippingAddress String
  phoneNumber     String
  notes           String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  user            User        @relation(fields: [userId], references: [id])
  items           OrderItem[]
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId Int
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
}

model Review {
  id              String   @id @default(cuid())
  productId       Int
  userId          String
  rating          Int      // 1-5 stars
  comment         String?
  verifiedPurchase Boolean @default(false) // Whether user actually purchased the product
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId]) // One review per user per product
  @@index([productId])
  @@index([userId])
}

model SeasonalCampaign {
  id                Int      @id @default(autoincrement())
  slug              String   @unique
  badge             String
  title             String
  subtitle          String?
  description       String?
  heroImage         String?
  heroHeadline      String?
  heroSubheadline   String?
  accent            String?
  accentLight       String?
  accentDark        String?
  ctaPrimaryLabel   String?
  ctaPrimaryHref    String?
  ctaSecondaryLabel String?
  ctaSecondaryHref  String?
  isActive          Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
